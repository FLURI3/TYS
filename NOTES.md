# Заметки по настройке и отладке

## Yandex Music API

API Яндекс Музыки может иметь разные структуры ответов в зависимости от версии. Если возникают проблемы с получением треков, проверьте:

1. **Эндпоинт для лайкнутых треков** может отличаться. Возможные варианты:
   - `/users/{user_id}/likes/tracks` (текущий)
   - `/users/{user_id}/playlists/3` (playlistKind = 3)
   - `/users/{user_id}/likes/artists/{artist_id}/tracks`

2. **Структура ответа** может отличаться. В коде уже есть обработка разных структур:
   - `result.library.tracks`
   - `result.tracks`
   - Прямой массив треков

3. **Получение детальной информации о треках**:
   - Текущий метод использует POST `/tracks` с `track-ids`
   - Альтернатива: GET `/tracks/{track_id}` для каждого трека отдельно (медленнее)

## Spotify API

1. **Лимиты API**:
   - Поиск: 30 запросов в секунду
   - Добавление треков: 100 треков за запрос
   - Создание плейлиста: 50 в час на пользователя

2. **Улучшение поиска треков**:
   - Можно добавить поиск по альбому
   - Использовать fuzzy matching для названий
   - Проверять ISRC коды (если доступны)

## Отладка

### Проверка токена Яндекс Музыки

```python
import aiohttp

async def test_yandex_token(token):
    async with aiohttp.ClientSession() as session:
        headers = {"Authorization": f"OAuth {token}"}
        async with session.get(
            "https://api.music.yandex.net/account/status",
            headers=headers
        ) as response:
            print(await response.json())
```

### Проверка Spotify токена

Используйте Spotify API напрямую или проверьте через `/me` endpoint.

## Производительность

Для больших плейлистов (>1000 треков):
- Поиск треков выполняется последовательно, что может занять время
- Можно добавить параллельную обработку батчами
- Добавить промежуточные прогресс-обновления

## Безопасность

1. **Session Storage**: Текущая реализация хранит сессии в памяти. Для продакшена с высокой нагрузкой рекомендуется Redis.

2. **Таймауты**: Добавьте таймауты для HTTP запросов в `aiohttp.ClientSession`:
   ```python
   timeout = aiohttp.ClientTimeout(total=30)
   async with aiohttp.ClientSession(timeout=timeout) as session:
       ...
   ```

3. **Валидация токенов**: Перед использованием токена Яндекс можно вызывать `validate_token()`.

## Расширение функционала

### Поддержка других плейлистов

1. Добавить endpoint для получения списка плейлистов пользователя
2. Модифицировать фронтенд для выбора плейлиста
3. Обновить `YandexMusicService` для работы с конкретным плейлистом

### Экспорт в другие сервисы

Архитектура позволяет легко добавить поддержку других платформ:
- Apple Music
- YouTube Music
- Deezer

Создайте новый сервис по аналогии с `SpotifyService`.

